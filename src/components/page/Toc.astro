---
const { content } = Astro.props;
---

<div class="toc-container">
	<div class="toc-title">
		<strong>本頁目錄</strong>
	</div>
	<div class="toc-divider"></div>
	{
		content.map((item: { text: string; link: string }) => (
			<a class="toc-item" href={item.link} data-target={item.link}>
				<span class="toc-indicator"></span>
				<span class="toc-text">{item.text}</span>
			</a>
		))
	}
</div>

<script>
	// Active section detection
	function updateActiveTocItem() {
		const sections = document.querySelectorAll('main [id]');
		const tocItems = document.querySelectorAll('.toc-item');
		
		let currentSection = '';
		const scrollPosition = window.scrollY + 150;

		sections.forEach((section) => {
			const sectionTop = (section as HTMLElement).offsetTop;
			if (scrollPosition >= sectionTop) {
				currentSection = '#' + section.id;
			}
		});

		tocItems.forEach((item) => {
			const target = item.getAttribute('data-target');
			if (target === currentSection) {
				item.classList.add('active');
			} else {
				item.classList.remove('active');
			}
		});
	}

	// Update on scroll and load
	window.addEventListener('scroll', updateActiveTocItem);
	window.addEventListener('load', updateActiveTocItem);
	document.addEventListener('astro:page-load', updateActiveTocItem);
</script>

<style>
	.toc-container {
		max-width: 8.5rem;
		letter-spacing: 0.08rem;
		text-align: center;
		position: sticky;
		top: 13rem;
	}
	
	.toc-title {
		color: #fff;
		font-size: 1rem;
		margin-bottom: 0.5rem;
		line-height: 2rem;
	}
	
	.toc-divider {
		height: 0.1rem;
		width: 100%;
		background: #ccc;
		margin-bottom: 0.5rem;
	}
	
	.toc-item {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem;
		margin: 0.25rem 0;
		border-radius: 0.375rem;
		text-decoration: none;
		transition: all 0.3s ease;
		cursor: pointer;
	}
	
	.toc-indicator {
		width: 3px;
		height: 20px;
		background: #666;
		border-radius: 2px;
		transition: all 0.3s ease;
		flex-shrink: 0;
	}
	
	.toc-text {
		color: #ccc;
		font-size: 0.9rem;
		transition: color 0.3s ease;
		text-align: left;
	}
	
	.toc-item:hover .toc-indicator {
		background: #aaa;
		height: 24px;
	}
	
	.toc-item:hover .toc-text {
		color: #fff;
	}
	
	.toc-item.active .toc-indicator {
		background: #fff;
		height: 28px;
		width: 4px;
	}
	
	.toc-item.active .toc-text {
		color: #fff;
		font-weight: 600;
	}
</style>
