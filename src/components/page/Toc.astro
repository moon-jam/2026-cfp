---
const { content } = Astro.props;
---

<div class="toc-container">
	<div class="toc-title">
		<strong>本頁目錄</strong>
	</div>
	<div class="toc-divider"></div>
	{
		content.map((item: { text: string; link: string }) => (
			<a class="toc-item" href={item.link} data-target={item.link}>
				<span class="toc-indicator" />
				<span class="toc-text">{item.text}</span>
			</a>
		))
	}
</div>

<script>
	// Active section detection
	function updateActiveTocItem() {
		const sections = document.querySelectorAll("main [id]");
		const tocItems = document.querySelectorAll(".toc-item");

		let currentSection = "";
		const scrollPosition = window.scrollY + 150;

		sections.forEach(section => {
			const sectionTop = (section as HTMLElement).offsetTop;
			if (scrollPosition >= sectionTop && section.id !== "toc" && section.id !== "toc-toggle") {
				currentSection = "#" + section.id;
			}
		});

		tocItems.forEach(item => {
			const target = item.getAttribute("data-target");
			if (target === currentSection) {
				item.classList.add("active");
			} else {
				item.classList.remove("active");
			}
		});
	}

	// Update on scroll and load
	window.addEventListener("scroll", updateActiveTocItem);
	window.addEventListener("load", updateActiveTocItem);
	document.addEventListener("astro:page-load", updateActiveTocItem);
</script>
